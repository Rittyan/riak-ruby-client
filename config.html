<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<title>Configuration</title>
<link href="stylesheets/all.css" rel="stylesheet" type="text/css" />
<script src="javascripts/all.js" type="text/javascript"></script>
</head>
<body class='config'>
<header>
<nav>
<ul>
<li class='title'>riak-ruby-client</li>
<li><a href="./">Home</a></li>
<li><a href="kv.html">Key-Value</a></li>
<li><a href="yz.html">Search</a></li>
<li><a href="2i.html">Secondary Indexes</a></li>
<li><a href="crdt.html">CRDTs</a></li>
<li><a href="bucket_types.html">Bucket Types</a></li>
<li><a href="rspecs.html">Testing</a></li>
<li class='space'><a href="install.html">Installation</a></li>
<li><a href="config.html">Configuration</a></li>
<li><a href="https://github.com/basho/riak-ruby-client">Source</a></li>
<li><a href="https://rubygems.org/gems/riak-client">Gem</a></li>
</ul>
</nav>

</header>
<div class='content'>
<h1 class='title'>Configuration</h1>
<div id='toc'></div>
<div id='yielded'><p>Riak Ruby Client supports many different configuration options, for many kinds
of configuration setting.</p>

<h2>Connecting</h2>

<p>The simplest way to connect assumes Riak is listening for Protocol Buffers on
<code>localhost:8087</code>:</p>
<pre><code class="highlight ruby"><span class="n">c</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span>
</code></pre>

<p>If Riak is listening on a different protobuffs port:</p>
<pre><code class="highlight ruby"><span class="n">c</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span> <span class="ss">pb_port: </span><span class="mi">17017</span>
</code></pre>

<p>Or on another machine:</p>
<pre><code class="highlight ruby"><span class="n">c</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span> <span class="ss">host: </span><span class="s1">'riak.example'</span>
<span class="n">c</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span> <span class="ss">host: </span><span class="s1">'riak.example'</span><span class="p">,</span> <span class="ss">pb_port: </span><span class="mi">17017</span>
</code></pre>

<p>If you have multiple Riak nodes you want the client to use, you can set them up:</p>
<pre><code class="highlight ruby"><span class="n">c</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">nodes: </span><span class="p">[</span>
    <span class="p">{</span><span class="ss">host: </span><span class="s1">'riak1'</span><span class="p">},</span>
    <span class="p">{</span><span class="ss">host: </span><span class="s1">'riak2'</span><span class="p">,</span> <span class="ss">pb_port: </span><span class="mi">17017</span><span class="p">},</span>
    <span class="p">{</span><span class="ss">host: </span><span class="s1">'10.0.5.61'</span><span class="p">,</span> <span class="ss">pb_port: </span><span class="mi">17017</span><span class="p">}</span>
<span class="p">])</span>
</code></pre>

<h2>Security</h2>

<p>Riak 2 adds support for secure Protocol Buffers. To enable this, add an
<code>authentication</code> hash to your connection parameters.</p>

<h3>Password Authentication</h3>

<p>For password-based authentication, you&rsquo;ll use something like this:</p>
<pre><code class="highlight ruby"><span class="n">c</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">authentication: </span><span class="p">{</span>
  <span class="ss">user: </span><span class="s1">'zedo'</span><span class="p">,</span> <span class="c1"># required for all authentication, /do not/ use `username`</span>

  <span class="c1"># required if your Riak cluster doesn't have a system-recognized certificate</span>
  <span class="ss">ca_file: </span><span class="s2">"/etc/ssl/certs/corporate_ca.crt"</span><span class="p">,</span>

  <span class="ss">password: </span><span class="s1">'catnip'</span><span class="p">,</span> <span class="c1"># required for password-based authentication  </span>
<span class="p">})</span>
</code></pre>

<h3>Client Certificate Authentication</h3>

<p>For more-secure but harder-to-administer client certificate authentication,
configure a client certificate and key:</p>
<pre><code class="highlight ruby"><span class="n">c</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">authentication: </span><span class="p">{</span>
  <span class="ss">user: </span><span class="s1">'zedo'</span><span class="p">,</span> <span class="c1"># required for all authentication, /do not/ use `username`</span>

  <span class="c1"># required if your Riak cluster doesn't have a system-recognized certificate</span>
  <span class="ss">ca_file: </span><span class="s2">"/etc/ssl/certs/corporate_ca.crt"</span><span class="p">,</span>

  <span class="c1"># client-cert parameters support filenames, OpenSSL-compatible string data,</span>
  <span class="c1"># or properly initialized OpenSSL objects</span>
  <span class="ss">client_ca: </span><span class="s1">'/etc/ssl/certs/corporate_client_ca.crt'</span><span class="p">,</span> <span class="c1"># filename</span>
  <span class="ss">cert: </span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'/etc/ssl/certs/my_client.crt'</span><span class="p">),</span> <span class="c1"># string data</span>
  <span class="ss">key: </span><span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'/etc/ssl/keys/my_client.key'</span><span class="p">))</span> <span class="c1"># object</span>
<span class="p">})</span>
</code></pre>

<h3>Extra TLS Configuration</h3>

<ul>
<li><code>ssl_version</code>: force the Ruby client to use a specific TLS version. This key
is automatically converted to a symbol. You can configure any option in
<code>OpenSSL::SSL::SSLContext::METHODS</code>. If left unconfigured, attempts TLS 1.2,
TLS 1.1, and TLS 1.0 in order.</li>
<li><code>verify_mode</code>: permit the Ruby client to not verify the certificate Riak
presents. Defaults to <code>OpenSSL::SSL::VERIFY_PEER</code>.</li>
<li><code>crl</code>: set to <code>true</code> to enable Certificate Revocation List checking. This may
be unreliable in JRuby.</li>
<li><code>crl_file</code>: set to a path or a <code>String</code> of CRL data to check the Riak cert
against a specific CRL instead of the certificate&rsquo;s configured CRL endpoint.</li>
<li><code>ocsp</code>: set to <code>true</code> to enable Online Certificate Status Protocol checking.
This is known to not work in JRuby.</li>
</ul>

<p>The <code>crl_file</code> option will enable the <code>crl</code> option even if it is not explicitly
enabled or even if it is set to <code>false</code>: if you configure a CRL file, it <em>will</em>
be checked.</p>

<p>This example validates the certificate Riak presents against a pre-distributed
corporate CA, a pre-distributed certificate revocation list, and whatever OCSP
endpoint is in the certificate.</p>
<pre><code class="highlight ruby"><span class="n">c</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">authentication: </span><span class="p">{</span>
  <span class="ss">user: </span><span class="s1">'zedo'</span><span class="p">,</span>
  <span class="ss">password: </span><span class="s1">'catnip'</span><span class="p">,</span>
  <span class="ss">ca_file: </span><span class="s1">'/etc/ssl/certs/corporate_ca.crt'</span><span class="p">,</span>
  <span class="ss">crl_file: </span><span class="s1">'/etc/ssl/crls/revoked_corporate_certs.crl'</span><span class="p">,</span>
  <span class="ss">crl: </span><span class="kp">false</span><span class="p">,</span> <span class="c1"># ignored, see above</span>
  <span class="ss">ocsp: </span><span class="kp">true</span>
<span class="p">})</span>
</code></pre>

<h2>Client ID</h2>

<p>In some cases you might want to provide a specific client ID for your instance
of the Riak client:</p>
<pre><code class="highlight ruby"><span class="n">c</span> <span class="o">=</span> <span class="no">Riak</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span> <span class="ss">client_id: </span><span class="mi">1234567890</span>
</code></pre>
</div>
</div>
<footer>
Documentation generated at 2014-11-21 22:26:53 UTC from repo version 44037a8a01c74eeace60384c5fffa726e17acf32.
</footer>
</body>
</html>
